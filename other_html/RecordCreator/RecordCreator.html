<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSONGrapher Record Creator</title>
</head>
<body>
    <h1>Create JSONGrapher Record</h1>

    <form id="jsonForm">
        <label for="title">Enter Data-Type (such as experiment type):</label>
        <input type="text" id="title" name="title" required><br><br>

        <label for="plotTitle">Graph Title:</label>
        <input type="text" id="plotTitle" name="plotTitle" required><br><br>

        <label for="seriesName">Series Name:</label>
        <input type="text" id="seriesName" name="seriesName" required><br><br>

        <label for="uid">Dataset Series UID (optional):</label>
        <input type="text" id="uid" name="uid"><br><br>
       
        <label for="xLabel">X-Axis Label:</label>
        <input type="text" id="xLabel" name="xLabel" required><br><br>

        <label for="yLabel">Y-Axis Label:</label>
        <input type="text" id="yLabel" name="yLabel" required><br><br>

        <label for="xValues">X Values (copy and paste column):</label><br>
        <textarea id="xValues" name="xValues" rows="5" cols="50" required></textarea><br><br>

        <label for="yValues">Y Values (copy and paste column):</label><br>
        <textarea id="yValues" name="yValues" rows="5" cols="50" required></textarea><br><br>

        <button type="button" onclick="createJSON()">Create JSONGrapher Record File</button>
    </form>

    <script>
        function parseValues(input) {
            // Split input into lines, then process each line, splitting by commas or trimming spaces
            return input
                .split(/\r?\n/) // Split by line breaks
                .map(val => val.split(',').map(v => parseFloat(v.trim()))) // Handle commas within lines
                .flat() // Flatten the resulting array
                .filter(val => !isNaN(val)); // Remove any invalid values
        }

        function createJSON() {
            const title = document.getElementById('title').value;
            const uid = document.getElementById('uid').value;
            const seriesName = document.getElementById('seriesName').value;
            const plotTitle = document.getElementById('plotTitle').value;
            const xLabel = document.getElementById('xLabel').value;
            const yLabel = document.getElementById('yLabel').value;

            const xValues = parseValues(document.getElementById('xValues').value);
            const yValues = parseValues(document.getElementById('yValues').value);

            const jsonData = {
                comments: "// A JSON record can have any name, and any extension (such as .txt or .json). For example, CO2AdsorptionNaX.json. The top level title field defines which schema to use.",
                title: title,
                data: [
                    {
                        comments: "// The curly bracket starts a data series. A file can have more than one data series. The uid is an optional unique ID and can even be a doi, for example.",
                        uid: uid || "unique_id",
                        line: {
                            shape: "spline",
                            width: 3
                        },
                        name: seriesName,
                        type: "scatter",
                        x: xValues,
                        y: yValues,
                        extraInformation: "This is just an example of how to add extra information for a series."
                    }
                ],
                layout: {
                    comments: "// The title field of the layout is the title of the graph (not of a series).",
                    title: plotTitle,
                    xaxis: {
                        comments: "// The x axis title must include the units that are expected.",
                        title: `${xLabel} (x_unit)`,
                        showgrid: false,
                        autorange: true
                    },
                    yaxis: {
                        comments: "// The y axis title must include the units that are expected.",
                        title: `${yLabel} (y_unit)`,
                        autorange: true,
                        gridcolor: "rgb(208, 208, 208)",
                        ticksuffix: "  "
                    },
                    legend: {},
                    autosize: true,
                    plot_bgcolor: "rgb(242, 242, 242)",
                    paper_bgcolor: "rgb(242, 242, 242)"
                }
            };

            const blob = new Blob([JSON.stringify(jsonData, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'JSONGrapherRecord.json';
            link.click();
        }
    </script>
</body>
</html>
